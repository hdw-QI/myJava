<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dao.spring.mapper.DepartmentMapper">
    <insert id="addOne" parameterType="department">
        insert into department values (#{id},#{name},#{companyId},#{buildDate},#{number})
    </insert>

    <insert id="insertOne"
    useGeneratedKeys="true"
    keyProperty="id"
    >
        insert into department values (#{id},#{name},#{companyId},#{buildDate},#{number})
    </insert>

    <insert id="addByList">
        insert into department values
        <foreach collection="list" item="dep" separator=",">
            (null,#{dep.name},#{dep.companyId},#{dep.buildDate},#{dep.number})
        </foreach>
    </insert>


    <!--<set>会自动添加set关键字，并去掉最后一个if语句中多余的逗号。-->
    <!--companyId != ''、companyId == '男'适用于字符串类型-->
    <update id="update">
        update department
        <set>

            <if test="companyId != 0 and companyId != ''">
                companyId=#{companyId},
            </if>
            <if test="number != 0">
                number=#{number},
            </if>
        </set>
        <where>
            id=#{id}
        </where>
    </update>
    <delete id="deleteByArray">
        delete from department
        <where>
        <foreach collection="array" open="id in (" close=")" separator="," item="id">
            #{id}
        </foreach>
        </where>
    </delete>


    <select id="getAll" resultType="domain.entity.Department">
        select * from department
    </select>

    <select id="getManyById" resultType="domain.entity.Department">
        select * from department where id>#{id}
    </select>

    <select id="getManyByName" resultType="domain.entity.Department">
        select * from department where name like '%${name}%'
    </select>

    <!--为什么where后面加1=1
    任意条件都可能拼接到Sql中。如果有多个条件，从第二个条件开始前都需要加And关键字。
    加上1=1这个永久成立的条件，就不需要考虑后面的条件哪个是第一个条件，
    后面的条件前都加And关键字即可。-->
    <!--字符串参数可以在test属性中使用方法。如
    <if test="sex != null and sex.length() != 0">
       and sex = #{sex}
    </if>
    -->
    <select id="getByWhereMany" resultType="domain.entity.Department">
        select * from department where 1=1
        <if test="companyId != null">
            and companyId=#{companyId}
        </if>
        <if test="number != 0">
            and number>=#{number}
        </if>
    </select>

    <!--当只满足number > 0时，and number>=#{number}中的第一个and会自动去掉-->
    <select id="getByWhere" resultType="domain.entity.Department">
        select * from department
        <where>
            <if test="companyId != 0">
                companyId=#{companyId}
            </if>
            <if test="number > 0">
                and number>=#{number}
            </if>
        </where>
    </select>

    <select id="getByCondition" resultType="domain.entity.Department">
        select * from department
        <where>
            <choose>
                <when test="companyId &lt; 5">
                    name like '%${name}%'
                </when>
                <when test="companyId &lt; 10">
                    name = #{name}
                </when>
                <otherwise>
                    id=#{id}
                </otherwise>
            </choose>
        </where>
    </select>


    <resultMap id="getName" type="departmentVO">
        <!--可以自定义映射关系-->
    </resultMap>
    <select id="getNameById" resultMap="getName">
        SELECT  d.`id`,d.`name`,d.`companyId`,d.`buildDate`,d.`number`,c.`name` companyName FROM department d
        LEFT JOIN company c ON c.`id`=d.`companyId`
        where d.id=#{id}
    </select>

    <resultMap id="getAllDept" type="departmentCompanyVO">
        <id column="id" property="id"/>
        <result property="buildDate" column="buildDate"/>
        <result property="name" column="name"/>
        <result property="number" column="number"/>
        <result property="companyId" column="companyId"/>
        <association property="company" javaType="company">
            <id column="companyId" property="id"/>
            <result column="companyName" property="name"/>
            <result column="companyLocation" property="location"/>
            <result column="companyBuildDate" property="buildDate"/>
        </association>
    </resultMap>
    <select id="getAllByDeptId" resultMap="getAllDept">
        SELECT  d.`id`,d.`name`,d.`companyId`,d.`buildDate`,d.`number`,c.`id` companyId,c.`name` companyName, c.`location` companyLocation,c.`buildDate` companyBuildDate  FROM department d
        LEFT JOIN company c ON c.`id`=d.`companyId`
        where d.id=#{id}
    </select>

    <resultMap id="getDC" type="departmentCompanyVO">
        <association property="company" select="dao.spring.mapper.CompanyMapper.getById" column="companyId"/>
    </resultMap>
    <select id="getDCById" resultMap="getDC">
        select * from department where id=#{id}
    </select>


    <select id="getByCompanyId" resultType="domain.entity.Department">
        select * from department where companyId=#{id}
    </select>


</mapper>
